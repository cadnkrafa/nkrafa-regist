<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet">
  <script src="./config.js"></script>
  <style>
    body {
      font-family: 'Noto Sans Thai', sans-serif;
      background: #e9f4fb;
      margin: 0;
      padding: 20px;
      color: #1a237e;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 28px;
    }
    .toolbar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .toolbar button {
      padding: 8px 16px;
      background: #007aff;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #d1e9ff;
    }
    .action-btn {
      margin: 0 4px;
      padding: 5px 10px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    .edit-btn {
      background: #ffc107;
      color: black;
    }
    .delete-btn {
      background: #f44336;
      color: white;
    }
    .save-btn {
      background: #4caf50;
      color: white;
    }
    .cancel-btn {
      background: #9e9e9e;
      color: white;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 4px;
    }
    .menu {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .menu button {
      background: #00bcd4;
    }
    .status-check {
      font-weight: bold;
    }
    .status-yes {
      color: green;
    }
    .status-no {
      color: red;
    }
  </style>
</head>
<body>
  <h1>ADMIN DASHBOARD</h1>
  <div class="toolbar">
    <button onclick="addRow()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <div class="menu">
      <button onclick="resetSheet('tokens')">üîÑ Reset Tokens</button>
      <button onclick="resetSheet('regist')">üîÑ Reset Regist</button>
      <button onclick="resetSheet('draw')">üîÑ Reset ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
      <button onclick="manageList('rank')">üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏®</button>
      <button onclick="manageList('unit')">üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡πà‡∏ß‡∏¢</button>
    </div>
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</th>
        <th>‡∏¢‡∏®</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
        <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th>‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE</th>
        <th>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
        <th>‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡πà‡∏≤‡∏ô JS -->
    </tbody>
  </table>

  <script>
    const sheetUrl = SCRIPT_URL;
    let ranks = [], units = [], data = [], links = [];

    async function fetchData() {
      const rankRes = await fetch(sheetUrl + '?getRank=1');
      ranks = await rankRes.json();
      const unitRes = await fetch(sheetUrl + '?getUnit=1');
      units = await unitRes.json();
      const dataRes = await fetch(sheetUrl + '?getAdminList=1');
      data = await dataRes.json();
      const linkRes = await fetch(sheetUrl + '?getLinks=1');
      links = await linkRes.json();
      renderTable();
    }

    function renderTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.rtafId}</td>
          <td>${row.rank}</td>
          <td>${row.name}</td>
          <td>${row.position}</td>
          <td>${row.unit}</td>
          <td class="status-check ${isLinked(row.rtafId) ? 'status-yes' : 'status-no'}">
            ${isLinked(row.rtafId) ? '‚úÖ' : '‚ùå'}
          </td>
          <td><input type="checkbox" ${row.draw ? 'checked' : ''} onchange="updateDraw('${row.rtafId}', this.checked)"></td>
          <td>
            <button class="action-btn edit-btn" onclick="editRow(${index})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="action-btn delete-btn" onclick="deleteRow('${row.rtafId}')">‡∏•‡∏ö</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function isLinked(rtafId) {
      return links.some(row => String(row[1]) === String(rtafId));
    }

    function updateDraw(rtafId, checked) {
      fetch(`${sheetUrl}?updateDraw=1&rtafId=${rtafId}&value=${checked}`);
    }

    function deleteRow(rtafId) {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?')) {
        fetch(`${sheetUrl}?deleteData=1&rtafId=${rtafId}`).then(() => fetchData());
      }
    }

    function addRow() {
      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      // ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°
      alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤');
    }

    function editRow(index) {
      alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤');
    }

    function resetSheet(sheetName) {
      fetch(`${sheetUrl}?reset=${sheetName}`).then(() => alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô ' + sheetName + ' ‡πÅ‡∏•‡πâ‡∏ß'));
    }

    function manageList(type) {
      alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ' + type + ' ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
    }

    fetchData();
  </script>
</body>
</html>
