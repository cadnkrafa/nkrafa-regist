<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Admin | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="./config.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      font-family: 'Noto Sans Thai', sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fb;
    }
    header {
      background: #1a237e;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
    }
    header button {
      background: #d32f2f;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin: 15px 20px;
    }
    .toolbar .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .toolbar input[type="text"] {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      width: 220px;
      font-family: 'Noto Sans Thai', sans-serif;
    }
    .toolbar select {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      font-family: 'Noto Sans Thai', sans-serif;
    }
    .toolbar .actions {
      display: flex;
      gap: 10px;
    }
    .toolbar .actions button {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      border: none;
      font-family: 'Noto Sans Thai', sans-serif;
    }
    .toolbar .add-btn {
      background-color: #4caf50;
      color: white;
    }
    .toolbar .reset-btn {
      background-color: #ff9800;
      color: white;
    }

    table {
      width: 95%;
      margin: 10px auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      text-align: center;
    }
    th {
      background: #e0e0e0;
    }
    .checkbox {
      transform: scale(1.2);
    }
    .btn {
      padding: 5px 10px;
      margin: 0 2px;
      font-size: 13px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-family: 'Noto Sans Thai', sans-serif;
    }
    .btn.edit { background: #2196f3; color: white; }
    .btn.delete { background: #e53935; color: white; }
    .btn.save { background: #43a047; color: white; }
    .btn.cancel { background: #9e9e9e; color: white; }

    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <h1>ADMIN | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•</h1>
    <div>
      <button onclick="logout()"><i data-lucide="log-out" style="width:16px"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </header>

  <div class="toolbar">
    <div class="filters">
      <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
      <select id="unitFilter">
        <option value="">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
        <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å JS -->
      </select>
    </div>
    <div class="actions">
      <button class="add-btn" onclick="addNewRow()">
        <i data-lucide="plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </button>
      <button class="reset-btn" onclick="resetSheets()">
        <i data-lucide="rotate-ccw"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </button>
    </div>
  </div>

  <div id="mainTableWrapper">
    <table id="mainTable">
      <thead>
        <tr>
          <th>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</th>
          <th>‡∏¢‡∏®</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
          <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th>‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏•‡∏ô‡πå</th>
          <th>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
          <th>‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
        </tr>
      </thead>
      <tbody>
        <!-- ‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å JS -->
      </tbody>
    </table>
  </div>

  <script>
    lucide.createIcons();

    async function initLiff() {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) return liff.login();
      const profile = await liff.getProfile();
      const userId = profile.userId;

      const res = await fetch(`${SCRIPT_URL}?checkAdmin=true&userId=${userId}`);
      const isAdmin = await res.text();
      if (isAdmin !== 'true') {
        document.body.innerHTML = '<h2 style="padding:40px;text-align:center;color:red;">‚õî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>';
        return;
      }

      loadData(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin
    }

    function logout() {
      liff.logout();
      location.reload();
    }

    function resetSheets() {
      const confirmReset = confirm('‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô tokens, regist, rewarders?');
      if (!confirmReset) return;
      ['tokens', 'regist', 'rewarders'].forEach(sheet => {
        fetch(`${SCRIPT_URL}?reset=${sheet}`).then(() => {
          alert(`‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ${sheet} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß`);
        });
      });
    }

    function addNewRow() {
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà (‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)
      alert("üõ† ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà");
    }

    function loadData() {
      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Script ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      alert("üõ† ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Google Apps Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
    }

    window.onload = initLiff;
  </script>
</body>
</html>
