<!DOCTYPE html>
 <html lang="th">
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>QR Code Registration</title>
   <style>
     .qr-container {
       text-align: center;
       margin-top: 20px;
       margin-top: 30px;
     }
     .qr-code {
       width: 250px;
       height: 250px;
     }
     .error {
       color: red;
       text-align: center;
       margin-top: 20px;
     }
   </style>
 </head>
 <body>
   <h1 style="text-align: center;">QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h1>
   <h1 style="text-align: center;">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h1>
   <div class="qr-container">
     <img id="qrCodeImage" class="qr-code" src="" alt="QR Code ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
     <div id="errorMessage" class="error"></div>
   </div>
 
   <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
   <script>
     function getQueryParam(param) {
       const urlParams = new URLSearchParams(window.location.search);
       return urlParams.get(param);
     }
     const liffId = "2007226288-k77xbmX7"; // üëà ‡πÉ‡∏™‡πà LIFF ID ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
 
     liff.init({ liffId }).then(() => {
       if (!liff.isLoggedIn()) {
         liff.login();
         return;
       }
 
     const userId = getQueryParam("userId");
       return liff.getProfile();
     }).then(profile => {
       const userId = profile.userId;
       console.log("‚úÖ LINE userId:", userId);
       fetchQRCode(userId);
     }).catch(err => {
       console.error("‚ùå LIFF error:", err);
       document.getElementById("errorMessage").innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ";
     });
 
     function fetchQRCode(userId) {
       const scriptUrl = `https://script.google.com/macros/s/AKfycbxT4YBr2MBhoTZc0ogk1FCmnHy2HGkDuyw-fTv7roVQrD1zlDNAU0nhNtbwBdMPrG4Ckg/exec?userId=${encodeURIComponent(userId)}`; // üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL Google Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
 
     if (userId) {
       const scriptUrl = `https://script.google.com/macros/s/AKfycbxT4YBr2MBhoTZc0ogk1FCmnHy2HGkDuyw-fTv7roVQrD1zlDNAU0nhNtbwBdMPrG4Ckg/exec?userId=${encodeURIComponent(userId)}`;
       
       fetch(scriptUrl)
         .then(response => response.json())
         .then(res => res.json())
         .then(data => {
           if (data.qrCodeUrl) {
             document.getElementById("qrCodeImage").src = data.qrCodeUrl;
           } else {
             document.getElementById("errorMessage").innerText = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á QR Code ‡πÑ‡∏î‡πâ";
           }
         })
         .catch(error => {
           console.error("Error fetching QR Code: ", error);
           document.getElementById("errorMessage").innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
         .catch(err => {
           console.error("‚ùå Fetch error:", err);
           document.getElementById("errorMessage").innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå";
         });
     } else {
       document.getElementById("errorMessage").innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö userId ‡πÉ‡∏ô URL";
     }
   </script>
 </body>
 </html>
